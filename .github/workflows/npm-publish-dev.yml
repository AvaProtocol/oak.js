name: NPM publish dev version

on:
  workflow_dispatch:
    inputs:
      ref:
        description: 'Branch or Tag'
        required: true
        default: 'main'
jobs:
  publish-dev-versions:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ¤˜ checkout
        uses: actions/checkout@v3

      - name: Set Git Ref
        id: set-ref
        run: echo "::set-output name=ref::${{ github.event.inputs.ref }}"

      - name: âš™ï¸ Setup Node.js environment
        uses: actions/setup-node@v3.0.0
        with:
          node-version: 18.x
          cache: 'npm'

      - name: ğŸ” Authenticate with NPM
        run: echo "//registry.npmjs.org/:_authToken=${{ secrets.NPM_AUTOMATION_TOKEN_CHRIS }}" > ~/.npmrc
      - run: npm ci --ignore-scripts

      # - name: âœŒï¸ Update versions (Commented for now since I donâ€™t think we should auto-upgrade dependencies)
      #   run: npx ts-node --esm ./scripts/update-dev-versions.ts

      - name: ğŸ› ï¸ Build
        run: npm run build

      - name: Publish packages to NPM with dev tag
          id: changesets
          uses: changesets/action@v1
          with:
            version: npm run changeset:version
            publish: npm run changeset:publish-dev
          env:
            NPM_TOKEN: ${{ secrets.NPM_AUTOMATION_TOKEN_CHRIS }}

